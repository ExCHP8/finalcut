name: "ARM build"

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 7 * * 2'

jobs:
  build:
    runs-on: ubuntu-latest
    name: Build on ${{ matrix.arch }}

    # Run steps on a matrix of 3 arch/distro combinations
    strategy:
      matrix:
        include:
          - arch: aarch64
          - arch: armv7
          - arch: armv6

    steps:
    - name: Repository checkout
      uses: actions/checkout@v2

    - name: Test on ARM architecture
      uses: uraimo/run-on-arch-action@v2.0.10
      id: build
      with:
        githubToken: ${{ github.token }}
        arch: ${{ matrix.arch }}
        distro: bullseye
        run: |
          lsb_release -a
          uname -a
          whoami
          tty || echo
          pwd
          # Install dependencies via apt-get
          add-apt-repository ppa:ubuntu-toolchain-r/test
          apt-get update
          apt-get -y install \
            ca-certificates \
            gcc \
            g++ \
            gpm \
            libgpm-dev \
            libcppunit-dev \
            autoconf-archive
          # Build 
          autoreconf -v --install --force
          ./configure --prefix=/usr
          make -j10

    - name: Get the output
      run: |
        echo "The uname output was ${{ steps.runcmd.outputs.uname }}"

